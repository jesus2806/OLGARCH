<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="AppGestorVentas.Views.UsuariosViews.AdministracionUsuariosView"
             x:Name="AdministracionUsuariosPage"
             xmlns:cnv="clr-namespace:AppGestorVentas.Converters"
             xmlns:helpers="clr-namespace:AppGestorVentas.Helpers">
    
    <ContentPage.Resources>
        <ResourceDictionary>
            <cnv:NumeroACadenaRolConverter x:Key="cnvNumeroACadenaRolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        
        <!--Vista escritorio-->

        <Grid x:Name="VistaEscritorio" RowDefinitions="Auto,300,Auto" Padding="20" Margin="0,30,0,0">

            <!-- Header: Buscador y Encabezados de la Tabla -->
            <StackLayout Grid.Row="0" Spacing="10" WidthRequest="850">
                <StackLayout Orientation="Horizontal" Margin="5">
                    <SearchBar Placeholder="Buscar por nombre o usuario"
                           WidthRequest="300"
                           Text="{Binding STextoBusqueda, Mode=TwoWay}"
                           SearchCommand="{Binding BuscarCommand}"/>
                    <Button Text="Limpiar"
                        Margin="10,0"
                             StyleClass="SecundaryButton"
                        Command="{Binding LimpiarBusquedaCommand}" />
                    <Button Text="Agregar Usuario" Command="{Binding AgregarUsuarioCommand}" HorizontalOptions="EndAndExpand" />

                </StackLayout>
                <Grid ColumnDefinitions="150,150,150,150,100,60,60" BackgroundColor="{StaticResource Secondary}" Padding="5">
                    <Label Text="Nombre" Grid.Column="0" FontAttributes="Bold"  TextColor="White" VerticalOptions="Center" HorizontalOptions="Center"/>
                    <Label Text="Apellido Paterno" Grid.Column="1" FontAttributes="Bold" TextColor="White" VerticalOptions="Center" HorizontalOptions="Center" />
                    <Label Text="Apellido Materno" Grid.Column="2" FontAttributes="Bold" TextColor="White" VerticalOptions="Center" HorizontalOptions="Center" />
                    <Label Text="Usuario" Grid.Column="3" FontAttributes="Bold" TextColor="White" VerticalOptions="Center" HorizontalOptions="Center" />
                    <Label Text="Rol" Grid.Column="4" FontAttributes="Bold" TextColor="White" VerticalOptions="Center" HorizontalOptions="Center" />
                    <Label Text="Acciones" Grid.Column="5" Grid.ColumnSpan="2" FontAttributes="Bold" TextColor="White" VerticalOptions="Center" HorizontalOptions="Center"/>


                </Grid>

                <Label 
                TextColor="Black"
                FontSize="14"
                Text="Sin información."
                IsEnabled="{Binding BNohayResultados}"
                IsVisible="{Binding BNohayResultados}"
                HorizontalTextAlignment="Center"/>
            </StackLayout>

            <!-- Body: CollectionView -->
            <CollectionView Grid.Row="1"
                        ItemsSource="{Binding OUsuarios}"
                        WidthRequest="850"
                        HorizontalOptions="Center"
                        SelectionMode="None"
                        Margin="0,10,0,10">
                <CollectionView.ItemTemplate>
                    <DataTemplate>

                        <Grid ColumnDefinitions="150,150,150,150,100,60,60" Padding="0,5">



                            <Label Text="{Binding sNombre}"
                               Grid.Column="0"
                               TextColor="Black"
                               HorizontalTextAlignment="Center"
                               VerticalOptions="Center"/>



                            <Label Text="{Binding sApellidoPaterno}"
                               Grid.Column="1"
                               TextColor="Black"
                               HorizontalTextAlignment="Center"
                               VerticalOptions="Center" />
                            <Label Text="{Binding sApellidoMaterno}"
                               Grid.Column="2"
                               TextColor="Black"
                               HorizontalTextAlignment="Center" 
                               VerticalOptions="Center" />
                            <Label Text="{Binding sUsuario}"
                               Grid.Column="3"
                               TextColor="Black"
                               HorizontalTextAlignment="Center"
                               VerticalOptions="Center" />
                            <Label Text="{Binding iRol, Converter={StaticResource cnvNumeroACadenaRolConverter}}"
                               Grid.Column="4"
                               TextColor="Black"
                               HorizontalTextAlignment="Center"
                               VerticalOptions="Center" />
                            <!-- Botón Actualizar -->
                            <Button FontFamily="MaterialDesignIcons" 
                                Text="{x:Static helpers:MaterialDesignIcons.AccountEdit}"
                                Command="{Binding Source={x:Reference AdministracionUsuariosPage},
                                Path=BindingContext.ActualizarUsuarioCommand}"
                                CommandParameter="{Binding .}"
                                Grid.Column="5"
                                Padding="0"
                                    BackgroundColor="{StaticResource Secondary}"
                                FontSize="20"
                                VerticalOptions="Center"
                                Margin="5,0" />
                            <!-- Botón Eliminar -->
                            <Button FontFamily="MaterialDesignIcons" 
                                Text="{x:Static helpers:MaterialDesignIcons.Delete}"
                                Command="{Binding Source={x:Reference AdministracionUsuariosPage},
                                Path=BindingContext.EliminarUsuarioCommand}"
                                CommandParameter="{Binding sIdMongo}"
                                Grid.Column="6"
                                    StyleClass="DeleteButton"
                                Padding="0"
                                FontSize="20"
                                VerticalOptions="Center"
                                Margin="5,0" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Footer: Paginación Fija -->
            <HorizontalStackLayout Grid.Row="2" HorizontalOptions="Center" Margin="0,10,0,0">
                <Button Text="Anterior"
                        Command="{Binding PaginaAnteriorCommand}"
                         StyleClass="SecundaryButton"
                        Margin="5,0" />
                <Label Text="{Binding SNumeroPaginaActual}"
                       VerticalOptions="Center"
                       HorizontalOptions="Center" />
                <Button Text="Siguiente"
                         StyleClass="SecundaryButton"
                        Command="{Binding PaginaSiguienteCommand}"
                        Margin="5,0" />
            </HorizontalStackLayout>

        </Grid>

        <!--Vista Movil-->

        <Grid x:Name="VistaAndroid" RowDefinitions="Auto,*,Auto"
        Padding="10"
        RowSpacing="10"
        MaximumWidthRequest="500"
        HorizontalOptions="Center">

            <!-- Encabezado: Botón Agregar Usuario y búsqueda -->
            <Grid Grid.Row="0"
          RowDefinitions="Auto,Auto"
          ColumnDefinitions="*,Auto"
          Margin="0,5">
                <!-- Botón Agregar Usuario -->
                <Button Grid.Row="0"
              Grid.ColumnSpan="2"
              Text="Agregar Usuario"
              Command="{Binding AgregarUsuarioCommand}"
              HorizontalOptions="Center"
              Margin="0,5"/>
                <!-- SearchBar y botón Limpiar -->
                <SearchBar Grid.Row="1"
                 Grid.Column="0"
                 Placeholder="Buscar por nombre o usuario"
                 Text="{Binding STextoBusqueda, Mode=TwoWay}"
                 SearchCommand="{Binding BuscarCommand}"
                 HorizontalOptions="Fill"/>
                <Button Grid.Row="1"
              Grid.Column="1"
                        StyleClass="SecundaryButton"
              Text="Limpiar"
              Command="{Binding LimpiarBusquedaCommand}" />
            </Grid>

            <!-- Cuerpo: Listado de usuarios en un CollectionView -->
            <CollectionView Grid.Row="1"
                    ItemsSource="{Binding OUsuarios}"
                    SelectionMode="None"
                    Margin="0,10"
                    EmptyView="Sin información.">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <!-- Cada usuario se muestra en un Border tipo tarjeta con estilo -->
                        <Border Stroke="{StaticResource Primary}"
                                StrokeThickness="1"
                                BackgroundColor="White"
                                Padding="10"
                                Margin="5,0,0,20">
                            <Grid RowSpacing="5" ColumnSpacing="5">
                                <Grid.RowDefinitions>
                                    <!-- Acciones en la parte superior -->
                                    <RowDefinition Height="Auto"/>
                                    <!-- Datos -->
                                    <RowDefinition Height="Auto"/>
                                    <!-- Nombre -->
                                    <RowDefinition Height="Auto"/>
                                    <!-- Apellido Paterno -->
                                    <RowDefinition Height="Auto"/>
                                    <!-- Apellido Materno -->
                                    <RowDefinition Height="Auto"/>
                                    <!-- Usuario -->
                                    <RowDefinition Height="Auto"/>
                                    <!-- Rol -->
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Acciones (ahora en la fila 0) -->
                                <Grid Grid.Row="0"
                                      Grid.Column="0"
                                      Grid.ColumnSpan="2"
                                      ColumnSpacing="10"
                                      Padding="5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <!-- Botón Actualizar -->
                                    <Button Grid.Column="0"
                                            FontFamily="MaterialDesignIcons"
                                            Text="{x:Static helpers:MaterialDesignIcons.AccountEdit}"
                                            BackgroundColor="{StaticResource Secondary}"
                                            Command="{Binding Source={x:Reference AdministracionUsuariosPage}, Path=BindingContext.ActualizarUsuarioCommand}"
                                            CommandParameter="{Binding .}"
                                            FontSize="20"
                                            HorizontalOptions="Center"
                                            TextColor="White"/>
                                    <!-- Botón Eliminar -->
                                    <Button Grid.Column="1"
                                            FontFamily="MaterialDesignIcons"
                                            Text="{x:Static helpers:MaterialDesignIcons.Delete}"
                                            Command="{Binding Source={x:Reference AdministracionUsuariosPage}, Path=BindingContext.EliminarUsuarioCommand}"
                                            CommandParameter="{Binding sIdMongo}"
                                            FontSize="20"
                                            StyleClass="DeleteButton"
                                            HorizontalOptions="Center"/>
                                </Grid>

                                <!-- Nombre -->
                                <Label Grid.Row="1"
                                       Grid.Column="0"
                                       Text="Nombre:"
                                       BackgroundColor="White"
                                       TextColor="{StaticResource PrimaryDark}"
                                       FontAttributes="Bold"
                                       Padding="5"
                                       VerticalTextAlignment="Center"/>
                                <Label Grid.Row="1"
                                        Grid.Column="1"
                                        Text="{Binding sNombre}"
                                        Padding="5"
                                        VerticalTextAlignment="Center"/>

                                <!-- Apellido Paterno -->
                                <Label Grid.Row="2"
                                       Grid.Column="0"
                                       Text="Apellido Paterno:"
                                       FontAttributes="Bold"
                                       BackgroundColor="White"
                                       TextColor="{StaticResource PrimaryDark}"
                                       Padding="5"
                                       VerticalTextAlignment="Center"/>
                                <Label Grid.Row="2"
                                       Grid.Column="1"
                                       Text="{Binding sApellidoPaterno}"
                                       Padding="5"
                                       VerticalTextAlignment="Center"/>

                                <!-- Apellido Materno -->
                                <Label Grid.Row="3"
                                       Grid.Column="0"
                                       Text="Apellido Materno:"
                                       FontAttributes="Bold"
                                       BackgroundColor="White"
                                       TextColor="{StaticResource PrimaryDark}"
                                       Padding="5"
                                       VerticalTextAlignment="Center"/>
                                <Label Grid.Row="3"
                                       Grid.Column="1"
                                       Text="{Binding sApellidoMaterno}"
                                       Padding="5"
                                       VerticalTextAlignment="Center"/>

                                <!-- Usuario -->
                                <Label Grid.Row="4"
                                       Grid.Column="0"
                                       Text="Usuario:"
                                       FontAttributes="Bold"
                                       BackgroundColor="White"
                                       TextColor="{StaticResource PrimaryDark}"
                                       Padding="5"
                                       VerticalTextAlignment="Center"/>
                                <Label Grid.Row="4"
                                       Grid.Column="1"
                                       Text="{Binding sUsuario}"
                                       Padding="5"
                                       VerticalTextAlignment="Center"/>

                                <!-- Rol -->
                                <Label Grid.Row="5"
                                       Grid.Column="0"
                                       Text="Rol:"
                                       FontAttributes="Bold"
                                       BackgroundColor="White"
                                       TextColor="{StaticResource PrimaryDark}"
                                       Padding="5"
                                       VerticalTextAlignment="Center"/>
                                <Label Grid.Row="5"
                                       Grid.Column="1"
                                       Text="{Binding iRol, Converter={StaticResource cnvNumeroACadenaRolConverter}}"
                                       Padding="5"
                                       VerticalTextAlignment="Center"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Pie de Página: Paginación -->
            <Grid Grid.Row="2"
                  ColumnDefinitions="Auto,*,Auto"
                  Padding="10">
                <Button Grid.Column="0"
                        Text="Anterior"
                        StyleClass="SecundaryButton"
                        Command="{Binding PaginaAnteriorCommand}" />
                <Label Grid.Column="1"
                        Text="{Binding SNumeroPaginaActual}"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"/>
                <Button Grid.Column="2"
                        Text="Siguiente"
                        StyleClass="SecundaryButton"
                        Command="{Binding PaginaSiguienteCommand}" />
            </Grid>

        </Grid>
    </Grid>
</ContentPage>